# coachtech-flea-market

`coachtech-flea-market` ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åŒå£«ãŒå•†å“ã‚’å£²è²·ã§ãã‚‹ãƒ•ãƒªãƒ¼ãƒãƒ¼ã‚±ãƒƒãƒˆã‚¢ãƒ—ãƒªã§ã™ã€‚  
ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€å•†å“ã® **å‡ºå“ãƒ»è³¼å…¥** ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚  
ã¾ãŸã€å–å¼•å¾Œã®ãƒãƒ£ãƒƒãƒˆã‚„è©•ä¾¡ã€ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½ã‚‚å‚™ãˆã¦ã„ã¾ã™ã€‚

## **ä¸»ãªæ©Ÿèƒ½ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰**

-   ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³
-   å•†å“ã®å‡ºå“
-   å•†å“ã®è³¼å…¥
-   ãŠæ°—ã«å…¥ã‚Šç™»éŒ²ï¼ˆã„ã„ã­æ©Ÿèƒ½ï¼‰
-   ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½
-   å•†å“æ¤œç´¢æ©Ÿèƒ½
-   å–å¼•ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
-   å–å¼•è©•ä¾¡æ©Ÿèƒ½
-   ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½

ç°¡å˜ã«å•†å“ã‚’å£²è²·ã§ãã‚‹ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹ã‚’æä¾›ã—ã¾ã™ï¼

## ä½œæˆã—ãŸç›®çš„

æ¨¡æ“¬æ¡ˆä»¶ã‚’é€šã—ã¦å®Ÿè·µã«è¿‘ã„é–‹ç™ºçµŒé¨“ã‚’ç©ã¿ã€å®šç¾©ã•ã‚ŒãŸè¦ä»¶ã‚’å®Ÿè£…ã™ã‚‹èƒ½åŠ›ã‚’èº«ã«ã¤ã‘ã‚‹ã“ã¨ã€‚

## **æŠ€è¡“çš„ãªæ©Ÿèƒ½ä¸€è¦§ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰**

-   **èªè¨¼æ©Ÿèƒ½:** Laravel Fortifyï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã€ãƒ¡ãƒ¼ãƒ«èªè¨¼ï¼‰
    -   ãƒ¡ãƒ¼ãƒ«å—ä¿¡ãƒ†ã‚¹ãƒˆã¯ MailHog ã‚’ä½¿ç”¨
-   **å•†å“ç®¡ç†:** å•†å“ä¸€è¦§ãƒ»è©³ç´°ãƒšãƒ¼ã‚¸ã§ã®æ¤œç´¢æ©Ÿèƒ½
-   **æ±ºæ¸ˆæ©Ÿèƒ½:** Stripe ã‚’ç”¨ã„ãŸå•†å“è³¼å…¥å‡¦ç†
-   **ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½:** å–å¼•ã”ã¨ã®ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã€æœªèª­ç®¡ç†
-   **è©•ä¾¡æ©Ÿèƒ½:** è³¼å…¥è€…ãƒ»å‡ºå“è€…åŒæ–¹ã«ã‚ˆã‚‹å–å¼•è©•ä¾¡ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«å¹³å‡è©•ä¾¡è¡¨ç¤º
-   **ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½:** Mailhog ã‚’åˆ©ç”¨ã—ãŸãƒ¡ãƒ¼ãƒ«èªè¨¼ã€ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€å–å¼•å®Œäº†é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡
-   **ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿:** ãƒ†ã‚¹ãƒˆç”¨ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ 3 ååˆ†ã‚’ Seeder ã§ä½œæˆ
-   **ãã®ä»–:** Docker ã«ã‚ˆã‚‹é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ã€Webhooks ã«ã‚ˆã‚‹æ±ºæ¸ˆå‡¦ç†ç®¡ç†

## ä½¿ç”¨æŠ€è¡“ï¼ˆå®Ÿè¡Œç’°å¢ƒï¼‰

-   PHP7.4
-   Laravel8.83.27
-   MySQL8.0.26
-   Docker
-   Mailhog
-   Stripe

## ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆSeederï¼‰

é–‹ç™ºæ™‚ã«åˆ©ç”¨ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ **4 ååˆ†** ä½œæˆæ¸ˆã¿ã§ã™ã€‚  
ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã¯ `src/public/images/seed/avatars/` ã«æº–å‚™ã•ã‚ŒãŸç”»åƒãŒ `storage/app/public/avatars/` ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã€  
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚

### ä½œæˆã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§

| åå‰                 | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹     | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰  | ãƒ¦ãƒ¼ã‚¶ãƒ¼å | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ      |
| -------------------- | ------------------ | ----------- | ---------- | --------------------- |
| ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼       | test@example.com   | password123 | test_user  | avatars/test_user.png |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ A           | demo_a@example.com | password123 | user_a     | avatars/demo_a.png    |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ B           | demo_b@example.com | password123 | user_b     | avatars/demo_b.png    |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ Cï¼ˆè³¼å…¥è€…ï¼‰ | demo_c@example.com | password123 | user_c     | avatars/demo_c.png    |

---

ã“ã‚Œã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®å‹•ä½œç¢ºèªãŒå¯èƒ½ã§ã™ï¼š

-   è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã§ã®å•†å“å£²è²·ãƒ†ã‚¹ãƒˆ
-   å–å¼•ä¸­ã®ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®é€å—ä¿¡ãƒ†ã‚¹ãƒˆ
-   å–å¼•å®Œäº†å¾Œã®åŒæ–¹å‘è©•ä¾¡ï¼ˆè³¼å…¥è€… â‡” å‡ºå“è€…ï¼‰ãƒ†ã‚¹ãƒˆ
-   ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®æŒ™å‹•ç¢ºèªï¼ˆMailHog: http://localhost:8025ï¼‰

---

## æ©Ÿèƒ½è¦ä»¶ã«åŸºã¥ãä»•æ§˜è¿½åŠ 

### å–å¼•ãƒãƒ£ãƒƒãƒˆ

-   å‡ºå“è€…ãƒ»è³¼å…¥è€…é–“ã§å•†å“ã®å–å¼•ä¸­ã«ãƒãƒ£ãƒƒãƒˆå¯èƒ½
-   æœ¬æ–‡ï¼ˆ400 æ–‡å­—ä»¥å†…å¿…é ˆï¼‰ã¨ç”»åƒï¼ˆ.png/.jpegï¼‰ã®é€ä¿¡ã«å¯¾å¿œ
-   å…¥åŠ›å†…å®¹ä¿æŒæ©Ÿèƒ½ï¼ˆæœ¬æ–‡ã®ã¿ï¼‰
-   ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º

### å–å¼•è©•ä¾¡

-   å–å¼•å®Œäº†æ™‚ã« **è³¼å…¥è€… â†’ å‡ºå“è€…**ã€**å‡ºå“è€… â†’ è³¼å…¥è€…** ã®åŒæ–¹å‘ã§è©•ä¾¡å¯èƒ½
-   ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã«è©•ä¾¡ã®å¹³å‡ã‚’è¡¨ç¤ºï¼ˆå°æ•°ç‚¹ã¯å››æ¨äº”å…¥ï¼‰

### ãƒ¡ãƒ¼ãƒ«é€šçŸ¥

-   å–å¼•å®Œäº†å¾Œã€è‡ªå‹•çš„ã«å‡ºå“è€…ã¸é€šçŸ¥ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡
-   **Mailhog** (http://localhost:8025) ã§ç¢ºèªå¯èƒ½

## ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ

### **1. users ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼‰**

| ã‚«ãƒ©ãƒ å          | ãƒ‡ãƒ¼ã‚¿å‹     | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼ | èª¬æ˜                           |
| ----------------- | ------------ | -------- | ------ | -------- | ------------------------------ |
| id                | BIGINT       | â—‹        | â—‹      |          | ãƒ¦ãƒ¼ã‚¶ãƒ¼ ID                    |
| name              | VARCHAR(255) | â—‹        |        |          | ãƒ¦ãƒ¼ã‚¶ãƒ¼å                     |
| email             | VARCHAR(255) | â—‹        |        |          | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼‰ |
| profile_image     | VARCHAR(255) |          |        |          | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ               |
| username          | VARCHAR(255) | â—‹        |        |          | ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãªã©ï¼‰ |
| postal_code       | VARCHAR(255) |          |        |          | éƒµä¾¿ç•ªå·                       |
| address           | VARCHAR(255) |          |        |          | ä½æ‰€                           |
| building_name     | VARCHAR(255) |          |        |          | å»ºç‰©å                         |
| password          | VARCHAR(255) | â—‹        |        |          | ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰     |
| profile_completed | TINYINT(1)   | â—‹        |        |          | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å®Œäº†ãƒ•ãƒ©ã‚°         |
| created_at        | TIMESTAMP    |          |        |          | ä½œæˆæ—¥æ™‚                       |
| updated_at        | TIMESTAMP    |          |        |          | æ›´æ–°æ—¥æ™‚                       |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   UK: `email, username`

---

### **2. conditions ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå•†å“ã®çŠ¶æ…‹ï¼‰**

| ã‚«ãƒ©ãƒ å   | ãƒ‡ãƒ¼ã‚¿å‹     | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼ | èª¬æ˜                       |
| ---------- | ------------ | -------- | ------ | -------- | -------------------------- |
| id         | BIGINT       | â—‹        | â—‹      |          | å•†å“çŠ¶æ…‹ã® ID              |
| name       | VARCHAR(255) | â—‹        |        |          | çŠ¶æ…‹åï¼ˆè‰¯å¥½ãƒ»å‚·ã‚ã‚Šãªã©ï¼‰ |
| created_at | TIMESTAMP    |          |        |          | ä½œæˆæ—¥æ™‚                   |
| updated_at | TIMESTAMP    |          |        |          | æ›´æ–°æ—¥æ™‚                   |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   UK: `name`

---

### **3. addresses ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆé…é€å…ˆä½æ‰€ï¼‰**

| ã‚«ãƒ©ãƒ å      | ãƒ‡ãƒ¼ã‚¿å‹     | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼  | èª¬æ˜                    |
| ------------- | ------------ | -------- | ------ | --------- | ----------------------- |
| id            | BIGINT       | â—‹        | â—‹      |           | ä½æ‰€ ID                 |
| user_id       | BIGINT       | â—‹        |        | users(id) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰ |
| postal_code   | VARCHAR(8)   | â—‹        |        |           | éƒµä¾¿ç•ªå·                |
| address       | VARCHAR(255) | â—‹        |        |           | ä½æ‰€                    |
| building_name | VARCHAR(255) |          |        |           | å»ºç‰©å                  |
| created_at    | TIMESTAMP    |          |        |           | ä½œæˆæ—¥æ™‚                |
| updated_at    | TIMESTAMP    |          |        |           | æ›´æ–°æ—¥æ™‚                |

---

### **4. items ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå•†å“æƒ…å ±ï¼‰**

| ã‚«ãƒ©ãƒ å       | ãƒ‡ãƒ¼ã‚¿å‹     | NOT NULL     | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼       | èª¬æ˜                           |
| -------------- | ------------ | ------------ | ------ | -------------- | ------------------------------ |
| id             | BIGINT       | â—‹            | â—‹      |                | å•†å“ ID                        |
| code           | VARCHAR(255) | â—‹ (ãƒ¦ãƒ‹ãƒ¼ã‚¯) |        |                | å•†å“ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚ã‚Šï¼‰ |
| user_id        | BIGINT       | â—‹            |        | users(id)      | å‡ºå“è€… IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰          |
| condition_id   | BIGINT       | â—‹            |        | conditions(id) | å•†å“ã®çŠ¶æ…‹ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰      |
| name           | VARCHAR(255) | â—‹            |        |                | å•†å“å                         |
| brand          | VARCHAR(255) | â—‹            |        |                | ãƒ–ãƒ©ãƒ³ãƒ‰å                     |
| description    | VARCHAR(255) | â—‹            |        |                | å•†å“èª¬æ˜                       |
| price          | INTEGER      | â—‹            |        |                | ä¾¡æ ¼                           |
| item_image     | VARCHAR(255) |              |        |                | å•†å“ç”»åƒ                       |
| sold_out       | TINYINT(1)   | â—‹            |        |                | å£²ã‚Šåˆ‡ã‚Œãƒ•ãƒ©ã‚°                 |
| likes_count    | INTEGER      | â—‹            |        |                | ã„ã„ã­æ•°                       |
| comments_count | INTEGER      | â—‹            |        |                | ã‚³ãƒ¡ãƒ³ãƒˆæ•°                     |
| deleted_at     | TIMESTAMP    |              |        |                | ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆç”¨ã‚«ãƒ©ãƒ          |
| created_at     | TIMESTAMP    |              |        |                | ä½œæˆæ—¥æ™‚                       |
| updated_at     | TIMESTAMP    |              |        |                | æ›´æ–°æ—¥æ™‚                       |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   UK: `code`

---

### **5. categories ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚«ãƒ†ã‚´ãƒªæƒ…å ±ï¼‰**

| ã‚«ãƒ©ãƒ å   | ãƒ‡ãƒ¼ã‚¿å‹     | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼ | èª¬æ˜        |
| ---------- | ------------ | -------- | ------ | -------- | ----------- |
| id         | BIGINT       | â—‹        | â—‹      |          | ã‚«ãƒ†ã‚´ãƒª ID |
| name       | VARCHAR(255) | â—‹        |        |          | ã‚«ãƒ†ã‚´ãƒªå  |
| created_at | TIMESTAMP    |          |        |          | ä½œæˆæ—¥æ™‚    |
| updated_at | TIMESTAMP    |          |        |          | æ›´æ–°æ—¥æ™‚    |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   UK: `name`

---

### **6. category_items ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚«ãƒ†ã‚´ãƒªã¨å•†å“ã‚’ç´ã¥ã‘ã‚‹ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

| ã‚«ãƒ©ãƒ å    | ãƒ‡ãƒ¼ã‚¿å‹  | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼       | èª¬æ˜                    |
| ----------- | --------- | -------- | ------ | -------------- | ----------------------- |
| id          | BIGINT    | â—‹        | â—‹      |                | ã‚«ãƒ†ã‚´ãƒªã‚¢ã‚¤ãƒ†ãƒ  ID     |
| category_id | BIGINT    | â—‹        |        | categories(id) | ã‚«ãƒ†ã‚´ãƒª IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰ |
| item_id     | BIGINT    | â—‹        |        | items(id)      | å•†å“ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰     |
| created_at  | TIMESTAMP |          |        |                | ä½œæˆæ—¥æ™‚                |
| updated_at  | TIMESTAMP |          |        |                | æ›´æ–°æ—¥æ™‚                |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   UK: `category_id, item_id` ï¼ˆè¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰

---

### **7. purchases ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè³¼å…¥æƒ…å ±ï¼‰**

| ã‚«ãƒ©ãƒ å        | ãƒ‡ãƒ¼ã‚¿å‹        | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼      | èª¬æ˜                                           |
| --------------- | --------------- | -------- | ------ | ------------- | ---------------------------------------------- |
| id              | BIGINT          | â—‹        | â—‹      |               | è³¼å…¥ ID                                        |
| user_id         | BIGINT          | â—‹        |        | users(id)     | è³¼å…¥è€… IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰                          |
| item_id         | BIGINT          | â—‹        |        | items(id)     | è³¼å…¥ã—ãŸå•†å“ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰                    |
| address_id      | BIGINT          | â—‹        |        | addresses(id) | é…é€å…ˆä½æ‰€ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰                      |
| payment_method  | VARCHAR(255)    | â—‹        |        |               | æ”¯æ‰•ã„æ–¹æ³•                                     |
| status          | VARCHAR(255)    | â—‹        |        |               | è³¼å…¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹                                 |
| transaction_id  | VARCHAR(255)    |          |        |               | å–å¼• IDï¼ˆæ±ºæ¸ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ IDï¼‰ |
| last_message_at | TIMESTAMP       |          |        |               | æœ€çµ‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ—¥æ™‚ï¼ˆæ–°ç€é †ã‚½ãƒ¼ãƒˆç”¨ï¼‰       |
| completed_at    | TIMESTAMP       |          |        |               | å–å¼•å®Œäº†æ—¥æ™‚                                   |
| created_at      | TIMESTAMP       |          |        |               | ä½œæˆæ—¥æ™‚                                       |
| updated_at      | TIMESTAMP       |          |        |               | æ›´æ–°æ—¥æ™‚                                       |
| index           | last_message_at |          |        |               | å–å¼•ãƒãƒ£ãƒƒãƒˆã‚’æ–°ç€é †ã«ä¸¦ã¹ã‚‹ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   IDX: `last_message_at`ï¼ˆæ–°ç€é †ã‚½ãƒ¼ãƒˆæœ€é©åŒ–ï¼‰

---

### **8. likes ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãŠæ°—ã«å…¥ã‚Šæƒ…å ±ï¼‰**

| ã‚«ãƒ©ãƒ å   | ãƒ‡ãƒ¼ã‚¿å‹  | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼  | èª¬æ˜                    |
| ---------- | --------- | -------- | ------ | --------- | ----------------------- |
| id         | BIGINT    | â—‹        | â—‹      |           | ã„ã„ã­ ID               |
| user_id    | BIGINT    | â—‹        |        | users(id) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰ |
| item_id    | BIGINT    | â—‹        |        | items(id) | å•†å“ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰     |
| created_at | TIMESTAMP |          |        |           | ä½œæˆæ—¥æ™‚                |
| updated_at | TIMESTAMP |          |        |           | æ›´æ–°æ—¥æ™‚                |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   UK: `user_id, item_id` ï¼ˆè¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰

---

### **9. comments ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæƒ…å ±ï¼‰**

| ã‚«ãƒ©ãƒ å   | ãƒ‡ãƒ¼ã‚¿å‹     | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼  | èª¬æ˜                                    |
| ---------- | ------------ | -------- | ------ | --------- | --------------------------------------- |
| id         | BIGINT       | â—‹        | â—‹      |           | ã‚³ãƒ¡ãƒ³ãƒˆ ID                             |
| user_id    | BIGINT       | â—‹        |        | users(id) | ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿è€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰ |
| item_id    | BIGINT       | â—‹        |        | items(id) | ã‚³ãƒ¡ãƒ³ãƒˆå¯¾è±¡ã®å•†å“ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰       |
| content    | VARCHAR(255) | â—‹        |        |           | ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹                            |
| created_at | TIMESTAMP    |          |        |           | ä½œæˆæ—¥æ™‚                                |
| updated_at | TIMESTAMP    |          |        |           | æ›´æ–°æ—¥æ™‚                                |

---

### **10. messages ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå–å¼•ãƒãƒ£ãƒƒãƒˆï¼‰**

| ã‚«ãƒ©ãƒ å    | ãƒ‡ãƒ¼ã‚¿å‹     | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼      | èª¬æ˜                             |
| ----------- | ------------ | -------- | ------ | ------------- | -------------------------------- |
| id          | BIGINT       | â—‹        | â—‹      |               | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ ID                    |
| purchase_id | BIGINT       | â—‹        |        | purchases(id) | å–å¼• IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰              |
| user_id     | BIGINT       | â—‹        |        | users(id)     | é€ä¿¡è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰    |
| body        | VARCHAR(400) | â—‹        |        |               | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡ï¼ˆæœ€å¤§ 400 æ–‡å­—ï¼‰  |
| image_path  | VARCHAR(255) |          |        |               | æ·»ä»˜ç”»åƒãƒ‘ã‚¹ï¼ˆä»»æ„ã€.png/.jpegï¼‰ |
| created_at  | TIMESTAMP    |          |        |               | ä½œæˆæ—¥æ™‚                         |
| updated_at  | TIMESTAMP    |          |        |               | æ›´æ–°æ—¥æ™‚                         |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   IDX: `purchase_id, created_at`ï¼ˆå–å¼•ã”ã¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ™‚ç³»åˆ—é †ã§å–å¾—ã™ã‚‹ãŸã‚ï¼‰

---

### **11. message_reads ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæœªèª­ç®¡ç†ï¼‰**

| ã‚«ãƒ©ãƒ å   | ãƒ‡ãƒ¼ã‚¿å‹  | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼     | èª¬æ˜                                |
| ---------- | --------- | -------- | ------ | ------------ | ----------------------------------- |
| id         | BIGINT    | â—‹        | â—‹      |              | æ—¢èª­ç®¡ç† ID                         |
| message_id | BIGINT    | â—‹        |        | messages(id) | å¯¾è±¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰       |
| user_id    | BIGINT    | â—‹        |        | users(id)    | æ—¢èª­ã‚’ã¤ã‘ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰ |
| created_at | TIMESTAMP |          |        |              | ä½œæˆæ—¥æ™‚                            |
| updated_at | TIMESTAMP |          |        |              | æ›´æ–°æ—¥æ™‚                            |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   UK: `message_id, user_id` ï¼ˆè¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰

---

### **12. ratings ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå–å¼•è©•ä¾¡ï¼‰**

| ã‚«ãƒ©ãƒ å    | ãƒ‡ãƒ¼ã‚¿å‹         | NOT NULL | ä¸»ã‚­ãƒ¼ | å¤–éƒ¨ã‚­ãƒ¼      | èª¬æ˜                                |
| ----------- | ---------------- | -------- | ------ | ------------- | ----------------------------------- |
| id          | BIGINT           | â—‹        | â—‹      |               | è©•ä¾¡ ID                             |
| purchase_id | BIGINT           | â—‹        |        | purchases(id) | é–¢é€£ã™ã‚‹å–å¼• IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰         |
| rater_id    | BIGINT           | â—‹        |        | users(id)     | è©•ä¾¡ã‚’ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰   |
| ratee_id    | BIGINT           | â—‹        |        | users(id)     | è©•ä¾¡ã‚’å—ã‘ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ IDï¼ˆå¤–éƒ¨ã‚­ãƒ¼ï¼‰ |
| score       | TINYINT UNSIGNED | â—‹        |        |               | è©•ä¾¡ã‚¹ã‚³ã‚¢ï¼ˆ1ã€œ5 ãªã©ï¼‰             |
| created_at  | TIMESTAMP        |          |        |               | ä½œæˆæ—¥æ™‚                            |
| updated_at  | TIMESTAMP        |          |        |               | æ›´æ–°æ—¥æ™‚                            |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ä¸€è¦§**

-   UK: `purchase_id, rater_id` ï¼ˆè¤‡åˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰

---

## ER å›³

![alt text](.drawio-1.png)

## ç’°å¢ƒæ§‹ç¯‰

### **1.ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³**

GitHub ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚

```
git clone https://github.com/chiemi123/coachtech-flea-market.git
```

```
cd coachtech-flea-market
```

### **2.Docker ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**

Docker ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ã¾ã™ã€‚

```
docker-compose up -d --build
```

### **3.Laravel ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ php ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

```
docker-compose exec php bash
```

Laravel ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ Laravel ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã—ã¾ã™ã€‚

```
composer install
```

.env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« .env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€.env.example ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

```
cp .env.example .env
```

### **4.ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã®ä½œæˆ**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```
php artisan key:generate
```

### **5.ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
php artisan migrate
```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œå¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

http://localhost

æ¨©é™ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
sudo chmod -R 777 *
```

#### **6. ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã®ä½œæˆ**

ç”»åƒã‚’ `public/storage` çµŒç”±ã§å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  
**å¿…ãš Seeder ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚**

```
php artisan storage:link
```

### **7.ã‚·ãƒ¼ãƒ€ãƒ¼ã®å®Ÿè¡Œ**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚·ãƒ¼ãƒ€ãƒ¼ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
php artisan db:seed
```

## ğŸ”‘ èªè¨¼æ©Ÿèƒ½ã«ã¤ã„ã¦

æœ¬ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã®ä»•çµ„ã¿ã« [Laravel Fortify](https://laravel.com/docs/fortify) ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ä½¿ç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³

-   Laravel Fortify v1.19.1

### ä¸»ãªæ©Ÿèƒ½

-   ãƒ­ã‚°ã‚¤ãƒ³ãƒ»æ–°è¦ç™»éŒ²
-   ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒªã‚»ãƒƒãƒˆ
-   ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹èªè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### å°å…¥æ‰‹é †

Fortify ã¯ `composer install` å®Ÿè¡Œæ™‚ã«è‡ªå‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚  
ã¾ãŸã€ç’°å¢ƒæ§‹ç¯‰æ™‚ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒé©åˆ‡ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã‚Œã°ã€è¿½åŠ ã®è¨­å®šã¯ä¸è¦ã§ã™ã€‚

## **ç”»åƒã®ä¿å­˜ä»•æ§˜**

æœ¬ã‚¢ãƒ—ãƒªã§ã¯ã€**å•†å“ç”»åƒ** ã¨ **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ** ã¯ Laravel ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆstorage ãƒ•ã‚©ãƒ«ãƒ€ï¼‰ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚  
ä¿å­˜ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’é€šã˜ã¦ Web ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

#### **1. ä¿å­˜å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**

| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª                      | ç”¨é€”                               |
| --------------------------------- | ---------------------------------- |
| `storage/app/public/item_images/` | å‡ºå“ã•ã‚ŒãŸå•†å“ã®ç”»åƒä¿å­˜å ´æ‰€       |
| `storage/app/public/avatars/`     | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒä¿å­˜å ´æ‰€   |
| `public/storage/item_images/`     | Web ã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼ˆå•†å“ç”»åƒï¼‰         |
| `public/storage/avatars/`         | Web ã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒï¼‰ |

---

## MailHog ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆé–‹ç™ºç’°å¢ƒç”¨ãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰

MailHog ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€é–‹ç™ºç’°å¢ƒã§é€ä¿¡ã•ã‚Œã‚‹ãƒ¡ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¢ºèªã§ãã¾ã™ã€‚

MailHog ã®èµ·å‹•  
MailHog ã¯ docker-compose up -d ã®æ™‚ç‚¹ã§èµ·å‹•ã—ã¦ã„ã¾ã™ã€‚  
ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€é€ä¿¡ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã§ãã¾ã™ã€‚

http://localhost:8025

.env ã®ãƒ¡ãƒ¼ãƒ«è¨­å®š
.env ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```env

MAIL_MAILER=smtp
MAIL_HOST=mailhog
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="example@example.com"
MAIL_FROM_NAME="${APP_NAME}"

```

ãã®å¾Œã€Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å†èµ·å‹•ã—ã¾ã™ã€‚

```
docker-compose restart
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

nginx / Apache ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```
docker-compose up -d
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

php artisan serve ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```
docker-compose exec app php artisan serve --host=0.0.0.0 --port=8000
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:8000 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

## Stripe æ±ºæ¸ˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### **1. Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ**

Stripe ã® API ã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€ã¾ãš **Stripe ã®å…¬å¼ã‚µã‚¤ãƒˆã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ** ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ğŸ”¹ **Stripe å…¬å¼ã‚µã‚¤ãƒˆ:** [https://dashboard.stripe.com/register](https://dashboard.stripe.com/register)

1. ä¸Šè¨˜ã®ãƒªãƒ³ã‚¯ã‹ã‚‰ **Stripe ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ**
2. [Stripe ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰](https://dashboard.stripe.com/) ã«ãƒ­ã‚°ã‚¤ãƒ³
3. **ã€Œé–‹ç™ºè€…ã€ â†’ ã€ŒAPI ã‚­ãƒ¼ã€** ã‹ã‚‰ **ã€Œå…¬é–‹å¯èƒ½ã‚­ãƒ¼ã€ (`STRIPE_KEY`)** ã¨ **ã€Œã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã€ (`STRIPE_SECRET`)** ã‚’å–å¾—

### **2. `.env` ã« Stripe ã® API ã‚­ãƒ¼ã‚’è¨­å®š**

Stripe ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ ã§ å…¬é–‹å¯èƒ½ã‚­ãƒ¼ ã¨ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ ã‚’å–å¾—ã—ã€.env ã«è¨­å®šã—ã¾ã™ã€‚

```ini

STRIPE_KEY=pk_test_xxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_SECRET=sk_test_xxxxxxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxxxxx

```

STRIPE_WEBHOOK_SECRET ã®å–å¾—æ–¹æ³•  
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€Webhook ã®ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã—ã¾ã™ã€‚

```
docker exec -it stripe_cli stripe listen --forward-to http://nginx/webhook/stripe
```

å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
> Ready! You are using Stripe API Version [2025-01-27.acacia].
Your webhook signing secret is whsec_d14f4c8e1f6ffe5f24e3aeddce46088719e00a66aab0c26c6018742d4dbf8813
(^C to quit)
```

ã“ã® whsec\_ ã‹ã‚‰å§‹ã¾ã‚‹å€¤ï¼ˆwhsec_xxxxxxxxxxxxxxxxxxxxxxxxï¼‰ã‚’ .env ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

ãã®å¾Œã€Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å†èµ·å‹•ã—ã¾ã™ã€‚

```
docker-compose restart
```

ã¾ãŸã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```
docker-compose up -d
```

### **3. Stripe ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹**

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€`stripe/stripe-php` ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```
docker-compose exec php composer show stripe/stripe-php
```

ã‚‚ã— stripe/stripe-php ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```
docker-compose exec php composer require stripe/stripe-php:^12.0
```

### **4.stripe ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒ**

Docker ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ stripe login ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  
åˆå›ã®ã¿ Stripe ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã®ã§ã€èªè¨¼ã‚’è¡Œã„ã¾ã™ã€‚

```
docker exec -it stripe_cli stripe login
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€Webhook ã®ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã—ã¾ã™ã€‚

```
docker exec -it stripe_cli stripe listen --forward-to http://nginx/webhook/stripe

```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€Webhook ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
docker exec -it stripe_cli stripe trigger checkout.session.completed
```

#### **1.ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã®ãƒ†ã‚¹ãƒˆ**

Stripe ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ã€ä»¥ä¸‹ã®ã‚«ãƒ¼ãƒ‰ç•ªå·ã‚’ä½¿ç”¨ã—ã¦æ±ºæ¸ˆãƒ†ã‚¹ãƒˆãŒã§ãã¾ã™ã€‚  
å…¥åŠ›æ™‚ã¯ **æœ‰åŠ¹æœŸé™ï¼šæœªæ¥ã®æ—¥ä»˜ï¼ˆä¾‹ï¼š12/34ï¼‰**ã€**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ¼ãƒ‰ï¼šä»»æ„ã® 3 æ¡ï¼ˆä¾‹ï¼š123ï¼‰** ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

| ã‚«ãƒ¼ãƒ‰ç•ªå·          | ã‚«ãƒ¼ãƒ‰ç¨®åˆ¥ | æˆåŠŸ or å¤±æ•—        |
| ------------------- | ---------- | ------------------- |
| 4242 4242 4242 4242 | Visa       | âœ… æˆåŠŸ             |
| 4000 0000 0000 0002 | Visa       | âŒ å¤±æ•—ï¼ˆæ±ºæ¸ˆæ‹’å¦ï¼‰ |
| 5555 5555 5555 4444 | Mastercard | âœ… æˆåŠŸ             |

#### **2.ã‚³ãƒ³ãƒ“ãƒ‹æ‰•ã„ã®æ±ºæ¸ˆãƒ†ã‚¹ãƒˆ**

ä»¥ä¸‹ã®æ‰‹é †ã§æ±ºæ¸ˆãƒ†ã‚¹ãƒˆãŒã§ãã¾ã™ã€‚

â‘  ã‚³ãƒ³ãƒ“ãƒ‹æ‰•ã„ã‚’é¸æŠã—ã€è³¼å…¥ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚  
stripe æ±ºæ¸ˆç”»é¢ã§ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨åå‰ã‚’å…¥åŠ›å¾Œã€æ”¯æ‰•ã†ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚

â‘¡ Webhook ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³  
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€å®Ÿéš›ã«ã€Œã‚³ãƒ³ãƒ“ãƒ‹ã§æ”¯æ‰•ã„ãŒå®Œäº†ã—ãŸã€çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã¾ã™ã€‚

```
docker exec -it stripe-cli stripe trigger payment_intent.succeeded
```

ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã§ã¯ã€ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã®ã‚ˆã†ã«ã€Œæ±ºæ¸ˆå®Œäº†ãƒšãƒ¼ã‚¸ã€ã«ã¯è‡ªå‹•ã§é·ç§»ã—ã¾ã›ã‚“ã€‚  
ãã®ãŸã‚ã€ä»¥ä¸‹ã®æ–¹æ³•ã§è³¼å…¥å®Œäº†ã‚’æ‰‹å‹•ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ğŸ”¹ æ–¹æ³• â‘ ï¼šãƒã‚¤ãƒšãƒ¼ã‚¸ (http://localhost/mypage) ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚  
è³¼å…¥ã—ãŸå•†å“ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

ğŸ”¹ æ–¹æ³• â‘¡ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§è³¼å…¥ãƒ†ãƒ¼ãƒ–ãƒ«ã® status ãŒ paid ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãŸã‚  
ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```
docker-compose exec php php artisan tinker
```

```
use App\Models\Purchase;
```

```
Purchase::where('status', 'paid')->get();
```
